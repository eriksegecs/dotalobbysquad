<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>DotaLobbySquad - Players</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  
  <!-- Favicons -->
  <link href="static/assets/img/favicon.png" rel="icon">
  <link href="static/assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="static/assets/vendor/animate.css/animate.min.css" rel="stylesheet">
  <link href="static/assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="static/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="static/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="static/assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="static/assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="static/assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="static/assets/css/style.css" rel="stylesheet">
  
  <!-- Incluindo a biblioteca DataTables CSS -->
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.0/css/jquery.dataTables.min.css">
    <style>
        /* Definindo o estilo personalizado para a tabela */
        body {
            background-color: black;
            color: white;
        }

        #userTable {
            background-color: black; /* Fundo da tabela em preto */
            color: white;
        }

        #userTable th,
        #userTable td {
            border-color: white; /* Definindo a cor da borda para branco */
        }

        #userTable img {
            width: 50px; /* Definindo o tamanho do avatar */
            height: 50px;
            object-fit: cover; /* Evitando que a imagem se estique */
            border-radius: 50%; /* Arredondando a imagem */
        }

        /* Ajustando a largura da coluna para o avatar */
        #userTable th:first-child,
        #userTable td:first-child {
            width: 60px;
            max-width: 60px;
        }

        /* Estilos para corrigir a cor do texto na tabela */
        #userTable_info,
        #userTable_paginate,
        #userTable_filter,
        #userTable_length {
            color: white; /* Definindo a cor do texto para branco */
        }

        #userTable_wrapper .dataTables_empty {
            color: white; /* Definindo a cor do texto para branco */
        }

        #userTable_wrapper .dataTables_info,
        #userTable_wrapper .dataTables_paginate .paginate_button {
            color: white; /* Definindo a cor do texto para branco */
        }

        /* Estilo personalizado para as linhas da tabela */
        #userTable tbody tr {
            background-color: black;
        }

        /* Estilo para células selecionadas */
        #userTable tbody tr.selected {
            background-color: black;
        }
        /* Deixar o fundo das células da primeira coluna em preto */
        #userTable tbody tr.odd td.sorting_1,
        #userTable tbody tr.even td.sorting_1 {
            background-color: #000000 !important;
            color: white !important;
        }
    </style>
</head>

<body>
  <!-- ======= Top Bar ======= -->
  <div id="topbar" class="d-flex align-items-center fixed-top">
    <div class="container d-flex justify-content-center justify-content-md-between">
      <div class="languages d-none d-md-flex align-items-center">
      </div>
    </div>
  </div>

  <!-- ======= Header ======= -->
  <header id="header" class="fixed-top d-flex align-items-cente">
    <div class="container-fluid container-xl d-flex align-items-center justify-content-lg-between">
      <h1 class="logo me-auto me-lg-0"><a href="/">DotaLobbySquad</a></h1>
      <nav id="navbar" class="navbar order-last order-lg-0">
        <ul>
          <li><a class="nav-link scrollto active" href="index.html">Home</a></li>
          <li><a class="nav-link scrollto" href="index.html#about">Conteúdo</a></li>
          <li><a class="nav-link scrollto" href="index.html#MMR">MMR</a></li>
          <li><a class="nav-link scrollto" href="index.html#Tabela">Tabela</a></li>
          <li><a class="nav-link scrollto" href="index.html#Chaves">Chaves</a></li>
          <li><a class="nav-link scrollto" href="index.html#equipe">Equipe</a></li>
          <li><a class="nav-link scrollto" href="index.html#testimonials">Bordões</a></li>
          <li><a class="nav-link scrollto" href="regras.html">Regras</a></li>
          
  </ul>

      </nav><!-- .navbar -->
      <div id="playerinfo">
        <img id ="avatarLink"/>
        <a id ="nickname" class=" d-none d-lg-flex"></a>
        <a id ="steamID" ></a>
      </div>
      <a class="book-a-table-btn scrollto" href="https://steamcommunity.com/openid/login?openid.ns=http://specs.openid.net/auth/2.0&openid.mode=checkid_setup&openid.return_to=https://www.lobbysquad.com.br/api/v1/auth/&openid.realm=https://www.lobbysquad.com.br/&openid.claimed_id=http://specs.openid.net/auth/2.0/identifier_select&openid.identity=http://specs.openid.net/auth/2.0/identifier_select">Login</a>
    </div>
  </header><!-- End Header -->



  <main id="main">

        <!-- ======= Players Section ======= -->
  <section id="Players" class="about">
    <div class="container" data-aos="fade-up">


    <h1>Tabela de players</h1>
    <table id="userTable" class="display" style="width:100%">
        <thead>
            <tr>
                <th>Avatar</th>
                <th>Nickname</th>
                <th>Real Name</th>
                <th>Team</th>
                <th>MMR Atual</th>
                <th>MMR Médio</th>
                <th>Matches Played After</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <!-- Incluindo as bibliotecas jQuery e DataTables JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.0/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/v/dt/jqc-1.12.4/dt-1.13.6/b-2.4.1/sl-1.7.0/datatables.min.css"/>
 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables.net-editor/2.2.2/dataTables.editor.js"></script>
    <script>
      
  // Endpoint da API
  const endpointUrl = 'https://www.lobbysquad.com.br/api/v1/players';


  // Função para preencher os dados da tabela utilizando o DataTables
  function populateDataTable(data) {
    const steamidCookie = getCookie("steamid"); // Substitua "steamid" pelo nome correto do cookie
    const table = $('#userTable').DataTable({
      data: data,
      columns: [
        {
          data: 'avatarmedium',
          render: (data, type, row) => `<img src="${data}" alt="Avatar de ${row.personaname}" width="50">`
        },
        {
          data: 'personaname',
          render: (data, type, row) => `<a href="${row.profileurl}" target="_blank">${data}</a>`
        },
        {
          data: 'realname',
          defaultContent: '' // Define um conteúdo padrão para a coluna realname quando o valor é undefined
        },
        {
        data: 'Attributes',
        render: (data) => {
          const team = data.find(attr => attr.Name === 'custom:actual_team');
          if (data.steamid.Value === steamidCookie) {
            return `
              <div class="team-container">
                <span class="team" data-personaname="${data.personaname}" data-team="${team ? team.Value : ''}">${team ? team.Value : ''}</span>
                <button class="edit-icon" title="Editar Equipe">&#9998;</button>
              </div>`;
          } else {
            return team ? team.Value : '';
          }
        }
      },
        {
          data: 'Attributes',
          render: (data) => {
            const mmrAttr = data.find(attr => attr.Name === 'custom:mmr');
            return mmrAttr ? mmrAttr.Value : '';
          }
        },
        {
          data: 'Attributes',
          render: (data) => {
            const mmrMedioAttr = data.find(attr => attr.Name === 'custom:mmr_medio_120');
            return mmrMedioAttr ? mmrMedioAttr.Value : '';
          }
        },
        {
          data: 'matches_played_after', // Utilizamos diretamente a propriedade matches_played_after
          defaultContent: ''
        },
        ],
     // Configuração para estilizar a tabela
     initComplete: function () {
      const tableWrapper = this.api().table().container();
      tableWrapper.style.background = 'black';

      // Adicione um evento de clique no ícone de edição da equipe
      $('#userTable').on('click', '.edit-icon', function (event) {
        event.stopPropagation(); // Impede a propagação do evento para o elemento pai (a célula da tabela)

        const teamContainer = $(this).closest('.team-container');
        const personaname = teamContainer.find('.team').data('personaname');
        const currentTeam = teamContainer.find('.team').data('team');

        const newTeam = prompt(`Editar equipe para: ${personaname}`, currentTeam);
        if (newTeam !== null) {
          // Faça a atualização da equipe usando uma chamada à API do Cognito
          // Atualize a célula na tabela com a nova equipe
          const row = table.row($(this).parents('tr'));
          const rowData = row.data();
          const teamAttr = rowData.Attributes.find(attr => attr.Name === 'custom:actual_team');
          teamAttr.Value = newTeam;
          row.invalidate();
        }
      });
    }
  });
}
// Função auxiliar para obter o valor de um cookie
function getCookie(cookieName) {
  const name = cookieName + "=";
  const decodedCookie = decodeURIComponent(document.cookie);
  const cookieArray = decodedCookie.split(';');
  for (let i = 0; i < cookieArray.length; i++) {
    let cookie = cookieArray[i];
    while (cookie.charAt(0) === ' ') {
      cookie = cookie.substring(1);
    }
    if (cookie.indexOf(name) === 0) {
      return cookie.substring(name.length, cookie.length);
    }
  }
  return "";
}

  // Fazer a requisição utilizando fetch
  fetch(endpointUrl)
    .then(response => response.json())
    .then(data => {
      if (data.statusCode === 200) {
        populateDataTable(data.body);
      } else {
        console.error('Erro na resposta da API.');
      }
    })
    .catch(error => console.error('Erro na requisição:', error));
    


    </script>
    
     </div>
  </section><!-- End Players Section -->


</main><!-- End #main -->

<!-- ======= Footer ======= -->
<footer id="footer">
  <div class="footer-top">
    <div class="container">
      <div class="row">

        <div class="col-lg-3 col-md-6">
          <div class="footer-info">
            <h3>DotaLobbySquad</h3>
        
      </div>
    </div>
  </div>

  <div class="container">
    <div class="copyright">
      &copy; Copyright <strong><span>Willzao -DotaLobbySquad </span></strong>. All Rights Reserved
    </div>
    <div class="credits">
      Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
    </div>
  </div>
</footer><!-- End Footer -->

<div id="preloader"></div>
<a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

<!-- Vendor JS Files -->
<script src="static/assets/vendor/aos/aos.js"></script>
<script src="static/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="static/assets/vendor/glightbox/js/glightbox.min.js"></script>
<script src="static/assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
<script src="static/assets/vendor/swiper/swiper-bundle.min.js"></script>
<script src="static/assets/vendor/php-email-form/validate.js"></script>
<script src="https://code.jquery.com/jquery-1.9.1.js"></script>
<script src="https://sdk.amazonaws.com/js/aws-sdk-2.668.0.min.js"></script>
<script src="https://sdk.amazonaws.com/js/amazon-cognito-auth.min.js"></script>
<script src="https://raw.githubusercontent.com/aws/aws-sdk-js/master/dist/aws-sdk.js"></script>
<script src="https://cdn.plot.ly/plotly-2.20.0.min.js" charset="utf-8"></script>
<script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css">
 <!-- Template Main JS File -->
 <script src="static/assets/js/main.js"></script>
 <script>
     async function getPlayerInfo() {
       try {
         // faz uma solicitação HTTP para a API para obter os dados do jogador
         const response = await fetch('https://www.lobbysquad.com.br/api/v1/info/');
         const playerData = await response.json();

         // seleciona o elemento <img> e altera o valor do atributo 'src'
         const playerAvatar = document.getElementById("avatarLink");
         playerAvatar.setAttribute("src", playerData.avatarLink);

         // seleciona o primeiro elemento <a> e altera seu conteúdo
         const playerName = document.getElementById("nickname");
         playerName.textContent = playerData.nickname;

         // seleciona o segundo elemento <a> e altera seu conteúdo e o atributo 'href'
         const playerID = document.getElementById("steamID");
         playerID.textContent = playerData.steamID;
         playerID.setAttribute("href", "https://steamcommunity.com/profiles/" + playerData.steamID);
       } catch (error) {
         // lida com erros de solicitação HTTP
         console.error('Erro ao buscar dados do jogador:', error);
       }
     }

     // chama a função assíncrona para buscar e atualizar as informações do jogador
     getPlayerInfo();

     </script>

</body>

</html>
